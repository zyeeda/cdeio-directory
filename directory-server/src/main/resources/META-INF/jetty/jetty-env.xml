<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE Configure PUBLIC "-//Mort Bay Consulting//DTD Configure//EN" "http://www.eclipse.org/jetty/configure.dtd">

<Configure class="org.eclipse.jetty.webapp.WebAppContext">

    <Call id="tm" name="getTransactionManager" class="bitronix.tm.TransactionManagerServices"/>
    <Call id="tsr" name="getTransactionSynchronizationRegistry" class="bitronix.tm.TransactionManagerServices"/>

    <New class="org.eclipse.jetty.plus.jndi.Resource">
        <Arg></Arg>
        <Arg>javax.transaction.TransactionManager</Arg>
        <Arg><Ref id="tm" /></Arg>
    </New>

    <New id="tx" class="org.eclipse.jetty.plus.jndi.Transaction">
        <Arg><Ref id="tm" /></Arg>
    </New>

    <New id="ctx" class="javax.naming.InitialContext">
        <Call id="comp" name="lookup">
            <Arg>java:comp</Arg>
        </Call>
    </New>

    <Call name="bind" class="org.eclipse.jetty.jndi.NamingUtil">
        <Arg><Ref refid="comp"/></Arg>
        <Arg>TransactionSynchronizationRegistry</Arg>
        <Arg><Ref id="tsr"/></Arg>
    </Call>

    <New class="org.eclipse.jetty.plus.jndi.Resource">
        <Arg>jdbc/defaultDS</Arg>
        <Arg>
            <New class="bitronix.tm.resource.jdbc.PoolingDataSource">
                <Set name="className">com.mysql.jdbc.jdbc2.optional.MysqlXADataSource</Set>
                <Set name="uniqueName">defaultDS</Set>
                <Set name="allowLocalTransactions">true</Set>
                <Set name="minPoolSize">0</Set>
                <Set name="maxPoolSize">5</Set>
                <Get name="driverProperties">
                    <Put name="URL">jdbc:mysql://localhost:3306/zyeeda-directory?pinGlobalTxToPhysicalConnection=true&amp;useUnicode=yes&amp;characterEncoding=UTF-8</Put>
                    <Put name="password">root</Put>
                    <Put name="user">root</Put>
                </Get>
                <Call name="init"></Call>
            </New>
        </Arg>
    </New>

</Configure>
