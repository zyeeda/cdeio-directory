<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE Configure PUBLIC "-//Mort Bay Consulting//DTD Configure//EN" "http://jetty.mortbay.org/configure.dtd">

<Configure class="org.mortbay.jetty.webapp.WebAppContext">
    
    <Call id="tm" name="getTransactionManager" class="bitronix.tm.TransactionManagerServices"/>
    <Call id="tsr" name="getTransactionSynchronizationRegistry" class="bitronix.tm.TransactionManagerServices"/>
    
    <New class="org.mortbay.jetty.plus.naming.Resource">
        <Arg></Arg>
        <Arg>javax.transaction.TransactionManager</Arg>
        <Arg><Ref id="tm" /></Arg>
    </New>
    
    <New id="tx" class="org.mortbay.jetty.plus.naming.Transaction">
        <Arg><Ref id="tm" /></Arg>
    </New>
    
    <New class="org.mortbay.jetty.plus.naming.Resource">
        <Arg>java:comp</Arg>
        <Arg>TransactionSynchronizationRegistry</Arg>
        <Arg><Ref id="tsr" /></Arg>
    </New>
    
    <New class="org.mortbay.jetty.plus.naming.Resource">
        <Arg>jdbc/defaultDS</Arg>
        <Arg>
            <New class="bitronix.tm.resource.jdbc.PoolingDataSource">
                <Set name="className">com.mysql.jdbc.jdbc2.optional.MysqlXADataSource</Set>
                <Set name="uniqueName">defaultDS</Set>
                <Set name="allowLocalTransactions">true</Set>
                <Set name="minPoolSize">0</Set>
                <Set name="maxPoolSize">5</Set>
                <Get name="driverProperties">
                    <Put name="URL">jdbc:mysql://localhost:3306/directory-client?pinGlobalTxToPhysicalConnection=true&amp;useUnicode=yes&amp;characterEncoding=UTF-8</Put>
                    <Put name="password">root</Put>
                    <Put name="user">root</Put>
                </Get>
                <Call name="init"></Call>
            </New>
        </Arg>
	</New>
    
</Configure>